# F5 BIG-IP Token Plugin ASCII Diagrams

## Token Generation and Usage Flow

```
+-------------+          +---------------+          +------------+          +---------+
| Application |          | HashiCorp     |          | F5 Token   |          | F5      |
|             |          | Vault         |          | Plugin     |          | BIG-IP  |
+------+------+          +-------+-------+          +-----+------+          +----+----+
       |                         |                        |                      |
       | Authenticate            |                        |                      |
       +------------------------>|                        |                      |
       |                         |                        |                      |
       |<------------------------+                        |                      |
       | Vault Token             |                        |                      |
       |                         |                        |                      |
       | Request F5 Token        |                        |                      |
       +------------------------>|                        |                      |
       |                         | Forward Request        |                      |
       |                         +----------------------->|                      |
       |                         |                        | Authenticate with    |
       |                         |                        | stored credentials   |
       |                         |                        +--------------------->|
       |                         |                        |                      |
       |                         |                        |<---------------------+
       |                         |                        | Generate Token       |
       |                         |                        |                      |
       |                         |                        | Store token details  |
       |                         |                        +---+                  |
       |                         |                        |   |                  |
       |                         |                        |<--+                  |
       |                         |                        |                      |
       |                         |<-----------------------+                      |
       |                         | Return token details   |                      |
       |                         |                        |                      |
       |<------------------------+                        |                      |
       | F5 token + metadata     |                        |                      |
       |                         |                        |                      |
       | API calls with F5 token |                        |                      |
       +-------------------------------------------------------------->|        |
       |                         |                        |            |        |
       |<--------------------------------------------------------------+        |
       | API responses           |                        |                      |
       |                         |                        |                      |
       |                         |                        | Periodic cleanup     |
       |                         |                        | of expired tokens    |
       |                         |                        +---+                  |
       |                         |                        |   |                  |
       |                         |                        |<--+                  |
       |                         |                        |                      |
+------+------+          +-------+-------+          +-----+------+          +----+----+
```

## Plugin Architecture

```
+-----------------------------------------------------------------------------------+
|                                                                                   |
|  +-------------------------------------------+                                    |
|  |           HashiCorp Vault                 |                                    |
|  |                                           |                                    |
|  |   +---------------+                       |                                    |
|  |   |   Vault API   |                       |                                    |
|  |   +-------+-------+                       |                                    |
|  |           |                               |                                    |
|  |           v                               |                                    |
|  |   +-------+------------------------+      |                                    |
|  |   |      F5 Token Plugin           |      |                                    |
|  |   |                                |      |                                    |
|  |   |  +-------------------------+   |      |                                    |
|  |   |  | Configuration Paths     |   |      |      +-------------------+         |
|  |   |  | /config/connection/*    +-->|      |      |                   |         |
|  |   |  +-------------------------+   |      |      |  Vault Storage    |         |
|  |   |                                |      |      |                   |         |
|  |   |  +-------------------------+   |      |      +-------------------+         |
|  |   |  | Token Paths             |   |      |                ^                   |
|  |   |  | /token/*                +-->|      |                |                   |
|  |   |  +-------------------------+   |      |                |                   |
|  |   |                                +------+----------------+                   |
|  |   |  +-------------------------+   |                                           |
|  |   |  | Tokens List Path        |   |                                           |
|  |   |  | /tokens                 +-->|                                           |
|  |   |  +-------------------------+   |                                           |
|  |   |                                |      +----------------------------+       |
|  |   |  +-------------------------+   |      |                            |       |
|  |   |  |                         |   |      |  +------------------------+|       |
|  |   |  |      Plugin Backend     +---+----->|  | F5 BIG-IP Device 1     ||       |
|  |   |  |                         |   |      |  | 172.16.10.10           ||       |
|  |   |  +------------+------------+   |      |  +------------------------+|       |
|  |   |               |                |      |                            |       |
|  |   |               v                |      |  +------------------------+|       |
|  |   |  +------------+------------+   |      |  | F5 BIG-IP Device 2     ||       |
|  |   |  |     F5 API Client        +----------->| 172.16.10.11           ||       |
|  |   |  +-------------------------+   |      |  +------------------------+|       |
|  |   |                                |      |                            |       |
|  |   +--------------------------------+      |  +------------------------+|       |
|  |                                           |  | F5 BIG-IP Device N     ||       |
|  +-------------------------------------------+  +------------------------+|       |
|                                                 +----------------------------+     |
|                                                                                   |
+-----------------------------------------------------------------------------------+

          ^                                             ^
          |                                             |
          |         1. Get token                        |  2. Use token
          |                                             |
    +-----+------+                                +-----+------+
    |            |                                |            |
    |Application1|                                |Application2|
    |            |                                |            |
    +------------+                                +------------+
```

## Token Lifecycle

```
                   +------------+
                   |            |
                   |  Requested |<-------------------+
                   |            |                    |
                   +-----+------+                    |
                         |                           |
                         | Plugin authenticates to F5|
                         v                           |
                   +------------+                    |
                   |            |                    |
                   | Generated  |                    |
                   |            |                    |
                   +-----+------+                    |
                         |                           |
                         | Token stored in Vault     |
                         v                           |
                   +------------+                    |
                   |            |                    |
            +----->|  Active    |                    |
            |      |            |                    |
            |      +-----+------+                    |
            |            |                           |
            |            | TTL reached               |
 App uses   |            v                           |
 token with |      +------------+                    |
 F5 BIG-IP  |      |            |        Manual      |
            |      |  Expired   |      Revocation    |
            |      |            |          +         |
            |      +-----+------+          |         |
            |            |                 |         |
            |            | Plugin          |         |
            |            | periodic        |         |
            |            | function        |         |
            |            v                 v         |
            |      +------------+    +------------+  |
            |      |            |    |            |  |
            |      |  Cleaned   |<---+  Revoked   +--+
            |      |            |    |            |
            +------+------------+    +------------+
``` 